<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="description" content="GestiÃ³n de secuestros informÃ¡ticos: recepciÃ³n, estadÃ­a y egreso">
  <meta name="theme-color" content="#0d1117">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Secuestros">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <link rel="stylesheet" href="css/styles.css?v=3">
  <title>Secuestros InformÃ¡ticos</title>
</head>

<body>

  <!-- TOAST -->
  <div id="toast"></div>

  <!-- LIGHTBOX -->
  <div class="lightbox" id="lightbox">
    <button class="lightbox-close" onclick="cerrarLightbox()">âœ•</button>
    <img id="lightbox-img" src="" alt="Foto ampliada">
  </div>

  <!-- MODAL ELIMINAR -->
  <div class="modal-overlay" id="modal-delete">
    <div class="modal-box">
      <h3>âš ï¸ Eliminar secuestro</h3>
      <p>Esta acciÃ³n no se puede deshacer. Â¿EstÃ¡s seguro que querÃ©s eliminar este secuestro?</p>
      <div class="modal-btns">
        <button class="btn btn-secondary" id="btn-cancel-delete">Cancelar</button>
        <button class="btn btn-danger" id="btn-confirm-delete">ğŸ—‘ï¸ Eliminar</button>
      </div>
    </div>
  </div>

  <div id="app">

    <!-- ===== TOPBAR ===== -->
    <header class="topbar">
      <button class="topbar__back" id="topbar-back" style="display:none">â†</button>
      <div class="topbar__title" id="topbar-title">ğŸ”’ <span>Secuestros</span></div>
      <div style="width:40px"></div>
    </header>

    <!-- ===== VISTA LISTA ===== -->
    <section class="view active" id="view-lista">
      <div class="stats-row">
        <div class="stat-card">
          <div class="stat-num" id="stat-total">0</div>
          <div class="stat-label">Total</div>
        </div>
        <div class="stat-card">
          <div class="stat-num" id="stat-activos" style="color:var(--warning)">0</div>
          <div class="stat-label">En custodia</div>
        </div>
        <div class="stat-card">
          <div class="stat-num" id="stat-egresados" style="color:var(--success)">0</div>
          <div class="stat-label">Egresados</div>
        </div>
      </div>

      <div class="search-wrap">
        <span class="icon">ğŸ”</span>
        <input type="text" id="searchInput" placeholder="Buscar por tÃ­tulo, cÃ³digo, ubicaciÃ³nâ€¦">
      </div>

      <div class="filter-chips">
        <div class="chip active" data-loc="">Todos</div>
        <div class="chip" data-loc="Base">Base</div>
        <div class="chip" data-loc="Fiscalia">FiscalÃ­a</div>
        <div class="chip" data-loc="Daic">Daic</div>
        <div class="chip" data-loc="Dipi">Dipi</div>
        <div class="chip" data-loc="Sala de Efectos">Sala Efectos</div>
        <div class="chip" data-loc="Constataciones" style="--chip-active:#c084fc">Constataciones</div>
      </div>

      <div class="card-list" id="card-list"></div>
    </section>

    <!-- ===== VISTA NUEVO SECUESTRO ===== -->
    <section class="view" id="view-nuevo">

      <!-- Scanner -->
      <div class="scanner-section">
        <h2>ğŸ“· Escanear CÃ³digo</h2>
        <p>ApuntÃ¡ la cÃ¡mara al cÃ³digo de barras del elemento</p>
        <div id="reader"></div>
        <div class="scanner-actions">
          <button class="btn btn-primary btn-sm" id="btn-iniciar-scanner">ğŸ“· Iniciar CÃ¡mara</button>
          <button class="btn btn-secondary btn-sm" id="btn-detener-scanner" style="display:none">â¹ Detener</button>
        </div>
        <div class="scanned-result" id="scanned-result">
          <span class="scan-ok">âœ…</span>
          <span class="scan-code" id="scanned-code-text"></span>
        </div>
      </div>

      <form id="form-nuevo" novalidate>

        <div class="form-section">
          <h2>Datos del elemento</h2>

          <div class="form-group">
            <label for="codigoBarras">CÃ³digo de Barras</label>
            <input type="text" id="codigoBarras" placeholder="Se completa al escanear o ingresÃ¡ manualmente">
          </div>

          <div class="form-group">
            <label for="titulo-nuevo">TÃ­tulo *</label>
            <input type="text" id="titulo-nuevo" placeholder="Ej: Notebook Dell negra" required>
          </div>

          <div class="form-group">
            <label for="fechaIngreso">Fecha de Ingreso *</label>
            <input type="date" id="fechaIngreso" required>
          </div>

          <div class="form-group">
            <label for="fechaEgreso-nuevo">Fecha de Egreso <span
                style="color:var(--text-muted);font-weight:400">(opcional)</span></label>
            <input type="date" id="fechaEgreso-nuevo">
          </div>
        </div>

        <div class="form-section">
          <h2>UbicaciÃ³n fÃ­sica</h2>
          <div class="location-grid" id="location-grid-nuevo"></div>
        </div>

        <!-- FOTOS -->
        <div class="form-section">
          <h2>ğŸ–¼ï¸ Fotos</h2>
          <div class="photo-section">
            <div class="photo-grid" id="fotos-grid-nuevo"></div>
            <div class="photo-count-note" id="fotos-count-nuevo">0/8 fotos</div>
          </div>
        </div>

        <!-- PDFs â€” solo para Constataciones -->
        <div class="form-section constataciones-section" id="constataciones-section-nuevo">
          <h2>ğŸ“ PDFs â€” Constataciones</h2>
          <div class="pdf-section">
            <div class="pdf-list" id="pdfs-list-nuevo"></div>
            <label class="pdf-add-btn">
              ğŸ“ Adjuntar PDF
              <input type="file" accept="application/pdf" multiple id="pdf-input-nuevo">
            </label>
          </div>
        </div>

        <div class="form-section">
          <h2>InformaciÃ³n adicional</h2>
          <div class="form-group" style="margin-bottom:0">
            <textarea id="informacion-nuevo"
              placeholder="DescripciÃ³n del elemento, observaciones, nÃºmero de causa, etc."></textarea>
          </div>
        </div>

        <button type="submit" class="btn btn-primary btn-full" style="margin-top:4px">
          ğŸ’¾ Guardar Secuestro
        </button>

      </form>
    </section>

    <!-- ===== VISTA DETALLE / EDICIÃ“N ===== -->
    <section class="view" id="view-detalle">
      <!-- Generado dinÃ¡micamente por renderDetalle() -->
    </section>

  </div><!-- /#app -->

  <!-- FAB -->
  <button class="fab" id="fab-nuevo" title="Nuevo secuestro">ï¼‹</button>

  <!-- BOTTOM NAV -->
  <nav class="bottom-nav">
    <button class="nav-btn active" id="nav-lista">
      <span class="nav-icon">ğŸ—‚ï¸</span>
      <span>Lista</span>
    </button>
    <button class="nav-btn" id="nav-nuevo">
      <span class="nav-icon">â•</span>
      <span>Nuevo</span>
    </button>
  </nav>

  <!-- SCRIPTS -->
  <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
  <script src="js/db.js?v=3"></script>
  <script src="js/scanner.js?v=3"></script>
  <script src="js/app.js?v=3"></script>

  <script>
    // Unregister stale service workers so updated files are always loaded
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations().then(regs => {
        return Promise.all(regs.map(r => r.unregister()));
      }).then(() => {
        return navigator.serviceWorker.register('sw.js');
      }).catch(() => { });
    }
  </script>

</body>

</html>